# 5. Custom Knowledge Sources in CrewAI

Hereâ€™s a detailed, beginner-friendly explanation of **Custom Knowledge Sources in CrewAI** with real-world examples, a structured breakdown, and well-commented code to help you understand everything step by step.  

---

# ğŸš€ **Understanding Custom Knowledge Sources in CrewAI**
CrewAI allows us to create **custom knowledge sources** by extending the `BaseKnowledgeSource` class. This means we can fetch data from any external API, database, or document and use it to make our AI agents more intelligent and context-aware.  

---

## ğŸ¯ **Why Use Custom Knowledge Sources?**
- ğŸ“¡ Fetch **real-time data** from APIs (e.g., space news, stock prices, weather updates).  
- ğŸ“ Train AI agents with **specific knowledge** (e.g., medical guidelines, legal documents).  
- ğŸ—ï¸ Allow **domain-specific AI agents** to answer questions based on dynamic, up-to-date information.  

### **ğŸŒ Real-World Example**
Imagine you're building an **AI chatbot for a space news website**. Instead of using outdated information, the chatbot should fetch **real-time space news articles** and answer user queries like:  
âœ… *"What are the latest updates on NASA's Mars mission?"*  
âœ… *"What new space exploration technologies were announced this week?"*  

To achieve this, we create a **custom knowledge source** that pulls live data from the **Spaceflight News API** and feeds it into a CrewAI agent.  

---

# ğŸ›  **Code Walkthrough: Creating a Custom Knowledge Source**
Hereâ€™s a **fully explained** implementation of a space news knowledge source:  

### **ğŸ“Œ Step 1: Import Required Libraries**
```python
from crewai import Agent, Task, Crew, Process, LLM
from crewai.knowledge.source.base_knowledge_source import BaseKnowledgeSource
import requests  # For making API calls
from datetime import datetime  # To work with dates
from typing import Dict, Any  # For type hinting
from pydantic import BaseModel, Field  # For data validation
```
âœ… `requests` â†’ Used to fetch live news from an API.  
âœ… `datetime` â†’ Helps manage article publishing dates.  
âœ… `BaseKnowledgeSource` â†’ Allows us to define a **custom knowledge source**.  

---

### **ğŸ“Œ Step 2: Create a Custom Knowledge Source Class**
```python
class SpaceNewsKnowledgeSource(BaseKnowledgeSource):
    """Knowledge source that fetches data from Space News API."""

    api_endpoint: str = Field(description="API endpoint URL")
    limit: int = Field(default=10, description="Number of articles to fetch")

    def load_content(self) -> Dict[Any, str]:
        """Fetch and format space news articles."""
        try:
            response = requests.get(f"{self.api_endpoint}?limit={self.limit}")
            response.raise_for_status()  # Check if the API call was successful

            data = response.json()  # Convert response to JSON format
            articles = data.get('results', [])  # Extract articles list

            formatted_data = self._format_articles(articles)  # Format articles into readable text
            return {self.api_endpoint: formatted_data}
        except Exception as e:
            raise ValueError(f"Failed to fetch space news: {str(e)}")

    def _format_articles(self, articles: list) -> str:
        """Format articles into readable text."""
        formatted = "ğŸš€ Space News Articles:\n\n"
        for article in articles:
            formatted += f"""
                ğŸ“° Title: {article['title']}
                ğŸ“… Published: {article['published_at']}
                ğŸ“ Summary: {article['summary']}
                ğŸŒ News Site: {article['news_site']}
                ğŸ”— URL: {article['url']}
                -------------------"""
        return formatted

    def add(self) -> None:
        """Process and store the articles."""
        content = self.load_content()  # Fetch latest articles
        for _, text in content.items():
            chunks = self._chunk_text(text)  # Break large text into small chunks
            self.chunks.extend(chunks)

        self._save_documents()  # Save processed articles
```
âœ… **`load_content()`** â†’ Fetches news articles from the API.  
âœ… **`_format_articles()`** â†’ Converts articles into a clean, readable format.  
âœ… **`add()`** â†’ Processes and stores the articles for AI use.  

---

### **ğŸ“Œ Step 3: Instantiate and Use the Custom Knowledge Source**
```python
# Create knowledge source to fetch the latest space news
recent_news = SpaceNewsKnowledgeSource(
    api_endpoint="https://api.spaceflightnewsapi.net/v4/articles",
    limit=10  # Fetch up to 10 articles
)
```
âœ… Here, we create an **instance** of `SpaceNewsKnowledgeSource` that will fetch **10 recent space news articles**.  

---

### **ğŸ“Œ Step 4: Define the AI Agent**
```python
space_analyst = Agent(
    role="ğŸ›°ï¸ Space News Analyst",
    goal="Answer questions about space news accurately and comprehensively",
    backstory="""You are a space industry analyst with expertise in space exploration,
    satellite technology, and space industry trends. You excel at answering questions
    about space news and providing detailed, accurate information.""",
    knowledge_sources=[recent_news],  # Attach the custom knowledge source
    llm=LLM(model="gpt-4", temperature=0.0)  # Use GPT-4 for responses
)
```
âœ… The agent is specialized in space news.  
âœ… It **uses** the `recent_news` knowledge source to fetch live data.  
âœ… **`temperature=0.0`** â†’ Ensures factual, non-random responses.  

---

### **ğŸ“Œ Step 5: Define the Task**
```python
analysis_task = Task(
    description="Answer this question about space news: {user_question}",
    expected_output="A detailed answer based on the recent space news articles",
    agent=space_analyst  # Assign task to the space analyst agent
)
```
âœ… This task takes a **user question** (e.g., â€œWhat are the latest space discoveries?â€) and generates a response using **real-time space news**.  

---

### **ğŸ“Œ Step 6: Create and Run the Crew**
```python
crew = Crew(
    agents=[space_analyst],  # Assign the space analyst agent
    tasks=[analysis_task],  # Assign the task
    verbose=True,  # Show detailed logs
    process=Process.sequential  # Execute tasks one by one
)

# Example usage
result = crew.kickoff(
    inputs={"user_question": "What are the latest developments in space exploration?"}
)
```
âœ… **`Crew`** manages the workflow between agents and tasks.  
âœ… **`kickoff()`** starts the process and **fetches** space news articles to answer the question.  

---

# ğŸ¯ **Key Takeaways**
### âœ… **What We Achieved**
- **Created a custom knowledge source** (`SpaceNewsKnowledgeSource`) that fetches **real-time space news**.  
- **Integrated it into a CrewAI agent** that specializes in answering **space-related questions**.  
- **Used GPT-4 to analyze news articles** and provide **detailed, accurate answers**.  

---

# ğŸ—ï¸ **How Can You Use This in the Real World?**
ğŸ”¹ **ğŸ“ˆ Stock Market Assistant** â†’ Fetches real-time stock prices and analyzes trends.  
ğŸ”¹ **ğŸ¦  Medical AI** â†’ Retrieves the latest research on diseases and treatments.  
ğŸ”¹ **ğŸ“… Event Tracker** â†’ Monitors tech events, conferences, and product launches.  
ğŸ”¹ **ğŸŒ¦ï¸ Weather Bot** â†’ Provides up-to-date weather reports.  

---

# ğŸ”¥ **Final Thoughts**
This approach **supercharges AI agents** by giving them **real-time knowledge** rather than relying on outdated training data. Whether you're building a **news bot**, a **financial advisor**, or a **legal assistant**, **custom knowledge sources** can take your AI applications to the next level! ğŸš€