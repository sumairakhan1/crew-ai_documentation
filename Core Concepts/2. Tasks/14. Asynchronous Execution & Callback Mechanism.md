
# 14. Asynchronous Execution & Callback Mechanism 

# âš¡ **Asynchronous Execution in CrewAI**  

## ğŸ› ï¸ **Why Use Asynchronous Execution?**  
In **CrewAI**, tasks can be executed **synchronously** (one after another) or **asynchronously** (executing in parallel).  

âœ… **When to use asynchronous execution?**  
âœ” Tasks **take a long time** but donâ€™t block progress.  
âœ” Multiple tasks **run independently** without waiting for each other.  
âœ” The output **isnâ€™t immediately needed** for the next step.  

ğŸš€ **Real-World Example:**  
Imagine you're building an **AI-driven content pipeline** for a blog. Your AI needs to:  
1ï¸âƒ£ Research **interesting AI article ideas**.  
2ï¸âƒ£ Research **AI history**.  
3ï¸âƒ£ Write an **article combining both**.  

Since the first two tasks **donâ€™t depend on each other**, they can run **simultaneously** to **save time**!  

---

# ğŸ¯ **Step 1: Running Tasks Asynchronously**  

```python
from crewai import Task, Crew

# ğŸ§  Define AI Agents (Assuming 'researcher' and 'writer' are already created)

# ğŸ” Task 1: Research AI article ideas
list_ideas = Task(
    description="List 5 interesting ideas for an article about AI.",
    expected_output="Bullet point list of 5 AI article ideas.",
    agent=researcher,
    async_execution=True  # âœ… Runs asynchronously
)

# ğŸ“œ Task 2: Research AI history
list_important_history = Task(
    description="Research the history of AI and find 5 key events.",
    expected_output="Bullet point list of 5 key AI history events.",
    agent=researcher,
    async_execution=True  # âœ… Runs asynchronously
)

# âœï¸ Task 3: Write an article combining both research tasks
write_article = Task(
    description="Write an article about AI, its history, and interesting ideas.",
    expected_output="A 4-paragraph article about AI.",
    agent=writer,
    context=[list_ideas, list_important_history]  # âœ… Waits for research tasks to complete
)

# ğŸ¯ Create a Crew
crew = Crew(
    agents=[researcher, writer],
    tasks=[list_ideas, list_important_history, write_article],
    verbose=True
)

# ğŸš€ Execute the CrewAI Workflow
result = crew.kickoff()
print(result)
```

---

# ğŸ“Œ **Breaking Down the Code**  

### ğŸ¯ **Step 1: Define Asynchronous Research Tasks**  
```python
list_ideas = Task(
    description="List 5 interesting ideas for an article about AI.",
    expected_output="Bullet point list of 5 AI article ideas.",
    agent=researcher,
    async_execution=True  # âœ… Runs asynchronously
)
```
âœ” **async_execution=True**: This task will run **in parallel** with other async tasks.  
âœ” The **researcher agent** will generate **5 AI article ideas**.  

---

### ğŸ¯ **Step 2: Define Another Asynchronous Task**  
```python
list_important_history = Task(
    description="Research the history of AI and find 5 key events.",
    expected_output="Bullet point list of 5 key AI history events.",
    agent=researcher,
    async_execution=True  # âœ… Runs asynchronously
)
```
âœ” This task **also runs asynchronously**, meaning it **doesn't wait** for `list_ideas` to finish.  
âœ” The AI **researches AI history** while another AI finds **article ideas**.  

---

### ğŸ¯ **Step 3: Write the Article (Using Previous Outputs)**  
```python
write_article = Task(
    description="Write an article about AI, its history, and interesting ideas.",
    expected_output="A 4-paragraph article about AI.",
    agent=writer,
    context=[list_ideas, list_important_history]  # âœ… Waits for both tasks to complete
)
```
âœ” The **writing agent** needs **both research outputs** to create a blog post.  
âœ” It **waits** for the first two **async tasks to complete** before running.  

---

### ğŸ¯ **Step 4: Execute the CrewAI Workflow**  
```python
crew = Crew(
    agents=[researcher, writer],
    tasks=[list_ideas, list_important_history, write_article],
    verbose=True
)

result = crew.kickoff()
print(result)
```
âœ” **Creates a Crew** with 3 tasks.  
âœ” **Asynchronous tasks** (`list_ideas` and `list_important_history`) run **in parallel**.  
âœ” **`write_article` waits** for them to finish before execution.  

---

# ğŸ“¢ **Benefits of Asynchronous Execution**  

âœ… **Saves Time**: Tasks run **simultaneously**, reducing waiting time.  
âœ… **Improves Efficiency**: AI **does more in less time**.  
âœ… **Ideal for Independent Tasks**: If two tasks **donâ€™t depend on each other**, they can run **in parallel**.  

---

# ğŸ”„ **Step 2: Using Callback Functions**  

ğŸ’¡ **What is a Callback?**  
A **callback function** runs **after a task is completed**. It allows us to:  

âœ” **Notify users** (e.g., send an email).  
âœ” **Trigger another action** (e.g., log results).  
âœ” **Save outputs** (e.g., store in a database).  

---

### ğŸ¯ **Example: Callback to Print Task Completion**  

```python
from crewai import Task, TaskOutput

# ğŸ“¢ Callback function that runs when the task is completed
def callback_function(output: TaskOutput):
    print(f"""
        âœ… Task Completed!
        ğŸ“Œ Task: {output.description}
        ğŸ“„ Output: {output.raw}
    """)

# ğŸ” Define a research task with a callback
research_task = Task(
    description="Find and summarize the latest AI news",
    expected_output="A bullet list of the top 5 AI news",
    agent=research_agent,
    tools=[search_tool],
    callback=callback_function  # âœ… Runs the callback when done
)

# ğŸš€ Run the CrewAI process
crew = Crew(agents=[research_agent], tasks=[research_task], verbose=True)
result = crew.kickoff()
```

---

# ğŸ“Œ **Breaking Down the Callback Code**  

### ğŸ¯ **Step 1: Define a Callback Function**  
```python
def callback_function(output: TaskOutput):
    print(f"""
        âœ… Task Completed!
        ğŸ“Œ Task: {output.description}
        ğŸ“„ Output: {output.raw}
    """)
```
âœ” Runs **after the task is finished**.  
âœ” Prints the **task description** and its **output**.  

---

### ğŸ¯ **Step 2: Attach Callback to a Task**  
```python
research_task = Task(
    description="Find and summarize the latest AI news",
    expected_output="A bullet list of the top 5 AI news",
    agent=research_agent,
    tools=[search_tool],
    callback=callback_function  # âœ… Runs the callback when done
)
```
âœ” **When the AI completes this task**, it **calls** `callback_function`.  

---

# ğŸ“¢ **Benefits of Using Callbacks**  

âœ… **Automation**: Send notifications, store outputs, or trigger new actions.  
âœ… **Monitoring**: Track task progress in real time.  
âœ… **Logging**: Save AI outputs for debugging or future reference.  

---

# ğŸ”¥ **Key Takeaways**  

âœ” **Asynchronous execution** allows **parallel task execution**, making workflows **faster** and **more efficient**.  
âœ” **Tasks with context** can **wait for async tasks** to complete before execution.  
âœ” **Callbacks** let us run **custom functions** after a task finishes.  

---

# ğŸš€ **Whatâ€™s Next?**  

Would you like to see:  
1ï¸âƒ£ **A working example with API calls?**  
2ï¸âƒ£ **Logging AI outputs in a database?**  

Let me know! ğŸš€